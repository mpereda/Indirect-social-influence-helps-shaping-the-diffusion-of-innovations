
   
    {% block title %}
    Práctica del experimento
{% endblock %}

{% block content %}
<div style=" float: left; width:75%">
    <div id="cy">
    </div>
    <input id="Restaurar" type="button" value="Restaurar vista" onclick="cy.fit();" />
</div>
    <aside style="float: right">
        <h2>Recuerde:</h2>
        <p>-  Usted es el nodo central.</p>
        <p>-  Los nodos situados en su círculo más cercano son sus amigos. Los situados en el siguiente círculo son los amigos de sus amigos, y así sucesivamente.</p>
        <p>-  Las líneas indican quién es amigo de quién. Puede situar el ratón sobre un nodo para que se ilumine, se iluminen sus amigos y se resalten las líneas entre ellos.</p>
        <p>-  Si un nodo aparece negro significa que no le estamos mostrando el color que ha elegido.</p>
        <p>-  La forma del nodo indica si el jugador está activo:</p>
        <div id="ex">

        </div>
    </aside>
    </div>
    <p>
        {{formfields}}
    </p>
    <button class="otree-btn-next btn btn-primary">Siguiente</button>
    <br></br>
    <div class="container ">
        <div class="row">
        </div>
    </div>
    <br></br>
    <h3>Recordatorio de las instrucciones</h3>
    
    <p>
        Este experimento pretende recrear la elección de diferentes medicamentos por los médicos de un hospital. Cada uno de
        los participantes representará a un médico, que mostraremos como un círculo, y los dos medicamentos entre los que
        tiene que elegir serán representados por colores dentro de los círculos durante este experimento. Al igual que los
        médicos tenían distintos amigos médicos dentro del hospital, en cada uno de las situaciones usted estará conectado con
        los participantes que representan a los médicos amigos, y podrá ir viendo qué colores han elegido.
    </p>
    <p>
        Para mostrar los resultados después de cada ronda, le mostraremos una imagen interactiva. En la imagen, usted
        aparecerá como un círculo en el centro, del color que haya elegido. A una distancia más cercana a usted, en un
        primer círculo gris, aparecen sus amigos, seguido de un círculo más claro con los amigos de sus amigos, y así en
        adelante. Los puntos conectados por líneas son amigos directos. Podrá situar el cursor sobre cada punto para que se
        iluminen sus amigos, ya que en la representación puede haber líneas superpuestas.
    </p>
    <p>
        Si algún participante se desconecta, su representación ya no será un punto sino que tendrá forma triangular,
        indicando que su decisión se ha tomado de manera automatizada esa ronda. Estos participantes inactivos tienen un 50%
        de probabilidad de escoger un color aleatoriamente y otro 50% de probabilidad de escoger el color que más le acerque
        al consenso.
    </p>
    <p>
        Cada situación constará de entre 10 y 15 rondas. En cada una de estas rondas tendrá que escoger uno de los colores, viendo
        los resultados justo después. En cada ronda le mostraremos información de distintos puntos. El resto de nodos se
        mostrarán en negro y no tendrá información sobre ellos. Es decir, los nodos negros también han escogido un color
        cada ronda, pero usted no sabrá cuál es.
    </p>
    <p>
        Su objetivo será conseguir que todos los participantes elijan el mismo color. Conseguirá tantos puntos como rondas
        queden antes de llegar al consenso. Además, se pagará un plus de 15 puntos si el color en el que se llega al consenso
        era el minoritario al comienzo (en este caso el Azul).
    </p>
    <p>
        Puede ocurrir que todos los nodos visibles para usted tengan el mismo color pero que el experimento no acabe. Eso
        significará que aún habrá participantes entre los no visibles para usted que hayan elegido el otro color.
    </p>
    <a>
        <img src="{% static 'global/ibsen-logo.png' %}" alt="logo de IBSEN" width="100%" style="border:1px solid black">
    </a>
    </footer>



{% endblock %}




{% block scripts %}


    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.1.0/cytoscape.js"></script>
    <script>

        var cy = window.cy = cytoscape({
            container: document.getElementById('cy'),

        });

        cy.add([
         { group: 'nodes', data: { id: 'n0' }, position: { x: 0, y: 0 }, style: {'width': 35, 'height': 35,'background-color': '#FFC300 ', 'label': 'USTED ESTÁ AQUÍ', 'z-index': '8', 'border-width' : 2} },

         { group: 'nodes', data: { id: 'n1' }, position: { x: 2/2*100, y: 2/2*100 }, style: {'width': 35, 'height': 35,'background-color': 'black','shape': 'triangle', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 'n2' }, position: { x: 0, y: 100 }, style: {'width': 35, 'height': 35,'background-color': 'black','shape': 'triangle', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 'n3' }, position: { x: -2/2*100, y: 2/2*100 }, style: {'width': 35, 'height': 35,'background-color': 'black','shape': 'triangle', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 'n4' }, position: { x: -100, y: 0 }, style: {'width': 35, 'height': 35,'background-color': 'black','shape': 'triangle', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 'n5' }, position: { x: -2/2*100, y: -2/2*100 }, style: {'width': 35, 'height': 35,'background-color': 'black','shape': 'triangle', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 'n6' }, position: { x: 0, y: -100 }, style: {'width': 35, 'height': 35,'background-color': 'black', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 'n7' }, position: { x: 2/2*100, y: -2/2*100 }, style: { 'width': 35, 'height': 35,'background-color': 'black', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 'n8' }, position: { x: 100, y: 0 }, style: {'width': 35, 'height': 35,'background-color': 'black','shape': 'triangle', 'z-index': '8', 'border-width' : 2} },

         { group: 'nodes', data: { id: 'a1' }, position: { x: 200, y: 0 },  style: {'width': 35/2, 'height': 35/2,'background-color': '#0072B2','shape': 'triangle', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 'a2' }, position: { x: 0, y: 200 },style: {'width': 35/2, 'height': 35/2,'background-color': '#0072B2', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 'a3' }, position: { x: -200, y: 0 }, style: {'width': 35/2, 'height': 35/2,'background-color': '#0072B2', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 'a4' }, position: { x: 0, y: -200 }, style: {'width': 35/2, 'height': 35/2,'background-color': '#0072B2', 'z-index': '8', 'border-width' : 2} },

         { group: 'nodes', data: { id: 's1' }, position: { x: 300, y: 0 },style: {'width': 35/3, 'height': 35/3,'background-color': '#FFC300 ', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 's2' }, position: { x: -300, y: 0 }, style: {'width': 35/3, 'height': 35/3,'background-color': '#FFC300 ', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 's3' }, position: { x: 0, y: -300 }, style: {'width': 35/3, 'height': 35/3,'background-color': '#FFC300 ', 'z-index': '8', 'border-width' : 2} },
         { group: 'nodes', data: { id: 's4' }, position: { x: 0, y: 300 },style: {'width': 35/3, 'height': 35/3,'background-color': '#FFC300 ', 'z-index': '8', 'border-width' : 2} },
// Central node and friends
         { group: 'edges', data: { id: 'e1', source: 'n0', target: 'n1' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e2', source: 'n0', target: 'n2' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e3', source: 'n0', target: 'n3' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e4', source: 'n0', target: 'n4' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e5', source: 'n0', target: 'n5' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e6', source: 'n0', target: 'n6' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e7', source: 'n0', target: 'n7' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e8', source: 'n0', target: 'n8' }, style: {'line-style': 'solid',  'z-index': '5'} },
// Intra-friends
         { group: 'edges', data: { id: 'e11', source: 'n1', target: 'n2' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e12', source: 'n1', target: 'n3' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e13', source: 'n1', target: 'n4' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e14', source: 'n2', target: 'n4' }, style: {'line-style': 'solid',  'z-index': '5'} },
// Friends and second layer      
         { group: 'edges', data: { id: 'e21', source: 'n1', target: 'a4' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e22', source: 'n2', target: 'a4' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e23', source: 'n7', target: 'a4' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e24', source: 'n1', target: 'a3' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e25', source: 'n4', target: 'a3' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e26', source: 'n5', target: 'a2' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e27', source: 'n3', target: 'a2' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e28', source: 'n4', target: 'a1' }, style: {'line-style': 'solid',  'z-index': '5'} },
// Intra-second layer
         { group: 'edges', data: { id: 'e31', source: 'a1', target: 'a2' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e32', source: 'a3', target: 'a4' }, style: {'line-style': 'solid',  'z-index': '5'} },
// Second and third layer
         { group: 'edges', data: { id: 'e41', source: 'a1', target: 's1' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e42', source: 'a1', target: 's4' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e43', source: 'a2', target: 's2' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e44', source: 'a3', target: 's2' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e45', source: 'a4', target: 's2' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e46', source: 'a4', target: 's3' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e47', source: 'a4', target: 's4' }, style: {'line-style': 'solid',  'z-index': '5'} },
// Intra-third layer
         { group: 'edges', data: { id: 'e51', source: 's1', target: 's2' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e52', source: 's1', target: 's3' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e53', source: 's1', target: 's4' }, style: {'line-style': 'solid',  'z-index': '5'} },
         { group: 'edges', data: { id: 'e54', source: 's2', target: 's3' }, style: {'line-style': 'solid',  'z-index': '5'} },

// Background nodes
         { group: 'nodes', data: { id: 'b1'}, position: { x: 0, y: 0 }, style : {'background-color':'black', 'background-opacity': '0.15', 'width': 350, 'height': 350, 'z-index': '7' } },
         { group: 'nodes', data: { id: 'b2'}, position: { x: 0, y: 0 }, style : {'background-color':'black', 'background-opacity': '0.15', 'width': 500, 'height': 500, 'z-index': '7' } },
         { group: 'nodes', data: { id: 'b3'}, position: { x: 0, y: 0 }, style : {'background-color':'black', 'background-opacity': '0.15', 'width': 700, 'height': 700, 'z-index': '7' } },
        ]);

        cy.nodes().style({"font-size": 20, "color": 'white', 'text-outline-width': 1, 'text-outline-color': 'black','z-index-compare': 'manual'}) 


        cy.fit()
        cy.autolock(true);
        cy.userZoomingEnabled(true);
      
        

        cy.$('node').on('mouseover', function (e) {
            var ele = e.target;
            ele.connectedEdges().style({ 'line-color': 'black', 'z-index' : 6});
            ele.neighborhood().style({'border-color' : 'red'});
            ele.style({'border-color' : 'red'});
        });     


        cy.$('node').on('mouseout', function (e) {
            var ele = e.target;
            ele.connectedEdges().style({ 'line-color': 'gray', 'z-index' : 5});
            ele.neighborhood().style({'border-color' : 'black'});
            ele.style({'border-color' : 'black'});
        });
        
        cy.on('mousedown', function (e) {
            const startX = e.position.x;
            const startY = e.position.y;        

            cy.on('mousemove', function (e) {
                const currentX = e.position.x;
                const currentY = e.position.y;

                const distanceX = currentX - startX;
                const distanceY = currentY - startY;
                
                cy.panBy({
                    x: distanceX,
                    y: distanceY
                });

                startX = currentX;
                startY = currentY;
            });
            cy.on('mouseup', function (e) {
                cy.off('mousemove');
            });
        });


    </script>

    <script>
        var ex = window.ex = cytoscape({
            container: document.getElementById('ex'),

        });
        
        ex.add([
        { group: 'nodes', data: { id: 'n0' }, position: { x: 0, y: 0 }, style: {'shape': 'triangle', 'label': ' Jugador Inactivo'} },
        { group: 'nodes', data: { id: 'n1' }, position: { x: 0, y: 35 }, style: {'label': '  Jugador Activo'} },
        ])

        ex.nodes().style({"font-size": 20, "color": 'black', 'text-halign': 'right', 'text-valign': 'center', 'background-color': 'black'}) 

        ex.fit()
        ex.autolock(true);
        ex.userPanningEnabled(false);
        ex.userZoomingEnabled(false);
    </script>


{% endblock %}

{% block styles %}
    <style type="text/css">
        #cy {
            height: 800px;
            display: block;
            border-style: inset;
            padding-top: 20px;
            padding-right: 20px;
            padding-bottom: 20px;
            padding-left: 20px;
        }

        aside {
            width: 20%;
            padding:2.5%;
        }

        .otree-btn-next{
            float: left;
            content: "Siguiente";
        }

        #ex {
            width: 100%;
            height: 75px;
            display: block;
        }
        footer {
            padding-top: 820px;            
        }
    </style>

{% endblock %}